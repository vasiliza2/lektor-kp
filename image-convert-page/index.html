<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="My Blog">
  <meta name="author" content="Andrew Shay">
  <link rel="icon" href="../static/img/favicon.ico">

  <title>My Blog</title>

  <link rel="stylesheet" href="../static/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <link rel="stylesheet" href="../static/css/custom.css">
</head>

<body>
  <main role="main" class="container">

    <!-- HEADER -->
    <header class="site-header py-3">
      <div class="row flex-nowrap justify-content-between align-items-center">
        <div class="col pt-1">
          <a class="site-header-name" href="/">
            <h1 class="site-header-name">My Blog</h1>
          </a>
        </div>
      </div>
    </header>
    <!-- END HEADER -->

    <!-- NAVIGATION -->
    <div class="container nav-bar">
      <div class="row nav">
        
          <a class="col-md-auto p-2" href="../">Home</a>
        
          <a class="col-md-auto p-2" href="../blog/">Blog</a>
        
          <a class="col-md-auto p-2" href="../single-column/">One Column MD</a>
        
          <a class="col-md-auto p-2" href="../single-column-html/">One Column HTML</a>
        
          <a class="col-md-auto p-2" href="../two-column-markdown/">Two Column MD</a>
        
          <a class="col-md-auto p-2" href="../two-column-html/">Two Column HTML</a>
        
          <a class="col-md-auto p-2" href="./">Image Convert Page</a>
        
      </div>
    </div>
    <!-- END NAVIGATION -->

    <div class="row">

      <!-- MAIN BODY -->
      <div class="col">

        
<!-- BLOG POST -->
<div>
  <h1>Image Convert Page</h1>
  <hr>
<h2>Upload and display image.</h2>
<p>Show image in html using Yandex Functions + JSON + JavaScript</p>

<form id="image-convert-form">
    <input type="file" id="image_file" name="image_file" accept="image/jpeg"><br>

    <input type="checkbox" id="image_invert" name="image_invert" value="checked">
    <label for="checkbox">Invert Image!</label><br>

    <input type="submit" value="Submit">
</form>

<p>Upload a JPEG image to display.</p>
<hr>
<hr>
<p>
    Original Uploaded Image:<br>
    <img id="original-image"
        src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3+iiigD//2Q==">
</p>
<hr>
<p>
    Remotely Inverted Image:<br>
    <img id="inverted-image"
        src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3+iiigD//2Q==">
</p>
<hr>
<p>
    EXIF Data:<br>
    <div id="exif-data"></div>
</p>

<script>
    const BLANK_IMAGE_JPEG_BASE64 = '/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3+iiigD//2Q=='

    const loadImageEncodedBase64 = (file) => {
        return new Promise((resolve, reject) => {
            const fileReader = new FileReader();

            fileReader.onload = () => {
                resolve(fileReader.result);
            };

            fileReader.onerror = (error) => {
                reject(error);
            };

            fileReader.readAsDataURL(file);
        });
    };

    const setImageSourceJpegBase64OrBlank = (imageId, responseDataKey, response) => {
        const image = document.querySelector(imageId);
        let base64Data = BLANK_IMAGE_JPEG_BASE64
        if (responseDataKey in response && response[responseDataKey]) {
            image.style.width = '100%';
            image.style.height = 'auto';
            base64Data = response[responseDataKey];
        } else {
            image.style.width = '1px';
            image.style.height = '1px';
        }
        image.setAttribute('src', 'data:image/jpeg;base64,' + base64Data)
    }

    // =================================================================
    const image_convert_form = document.getElementById('image-convert-form');
    image_convert_form.addEventListener('submit', (e) => {
        e.preventDefault();

        const formData = new FormData(image_convert_form);
        const fileImage = formData.get('image_file');

        if (!fileImage.name) {
            console.log('Image file not selected. Please select a file to upload/convert.');
            return;
        }

        loadImageEncodedBase64(fileImage).then(result => {
            const imageEncodedBase64 = result.replace(/^data:image\/(png|jpeg|jpg);base64,/, "");

            const message = {
                'image_file': fileImage.name,
                'image_data': imageEncodedBase64,
                'image_invert': 'checked' === formData.get('image_invert')
            };

            fetch('https://functions.yandexcloud.net/d4e2d4au7hisajqtngfc', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(message)
            }).then((response) => {
                return response.json()
            }).then((response) => {
                console.log(response);

                setImageSourceJpegBase64OrBlank('#original-image', 'uploaded_image_data', response);
                setImageSourceJpegBase64OrBlank('#inverted-image', 'image_changed_data', response);

                const exifDataContainer = document.querySelector('#exif-data');
                if ('uploaded_image_exif_data' in response && response['uploaded_image_exif_data']) {
                    const exifDataText = response['uploaded_image_exif_data'];
                    exifDataContainer.innerHTML = exifDataText;
                } else {
                    exifDataContainer.innerHTML = '';
                }
            }).catch((error) => {
                console.log(error);
            });

        }).catch(error => {
            console.log(error)
        });
    });
</script>

</div>
<!-- END BLOG POST -->

</div>
<!-- END MAIN BODY -->


    </div>
  </main>

  <footer class="site-footer">
    copyright 2023 My Blog
  </footer>

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>



</body>

</html>
